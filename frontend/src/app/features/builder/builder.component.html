<section class="builder">
  <header class="intro">
    <div>
      <h1>Configuratore</h1>
      <p>Seleziona una tipologia per esplorare i componenti disponibili, aggiungili alla tua build o direttamente al carrello.</p>
    </div>
    <div class="config-creation">
      <label>
        <span>Nome configurazione</span>
        <input [(ngModel)]="configurazioneNome" placeholder="Es. Build da gaming" />
      </label>
      <button class="btn" (click)="creaConfigurazione()" [disabled]="isSavingConfigurazione">
        {{ isSavingConfigurazione ? 'Creazione…' : configurazione ? 'Rigenera configurazione' : 'Crea configurazione' }}
      </button>
    </div>
  </header>

  <div class="alerts">
    <p class="alert error" *ngIf="configurazioneErrore">{{ configurazioneErrore }}</p>
    <p class="alert success" *ngIf="configurazioneMessaggio">{{ configurazioneMessaggio }}</p>
    <p class="alert error" *ngIf="cartErrore">{{ cartErrore }}</p>
    <p class="alert success" *ngIf="cartMessaggio">{{ cartMessaggio }}</p>
  </div>

  <div class="layout">
    <section class="catalogo">
      <div class="tipologie" *ngIf="tipologie.length">
        <button
          class="pill"
          *ngFor="let tip of tipologie"
          (click)="selezionaTipologia(tip)"
          [class.active]="tip === selectedTipologia"
        >
          {{ tip.replace('_', ' ') }}
        </button>
      </div>

      <div class="filtro">
        <label>
          <span>Filtra per marca</span>
          <input [(ngModel)]="ricercaMarca" (keyup.enter)="caricaComponenti(0)" placeholder="Es. AMD" />
        </label>
        <button class="ghost" (click)="caricaComponenti(0)">Applica filtro</button>
      </div>

      <div class="lista">
        <p *ngIf="componentiError" class="empty">{{ componentiError }}</p>
        <p *ngIf="loadingComponenti" class="empty">Caricamento componenti…</p>
        <div *ngIf="componenti && !loadingComponenti" class="cards">
          <article class="card" *ngFor="let comp of componenti.content">
            <header>
              <h2>{{ comp.nome }}</h2>
              <span class="badge">{{ comp.tipologia.replace('_', ' ') }}</span>
            </header>
            <p class="marca">{{ comp.marca }}</p>
            <dl>
              <div *ngIf="comp.socketCpu"><dt>Socket</dt><dd>{{ comp.socketCpu }}</dd></div>
              <div *ngIf="comp.chipsetScheda"><dt>Chipset</dt><dd>{{ comp.chipsetScheda }}</dd></div>
              <div *ngIf="comp.tipoMemoria"><dt>Memoria</dt><dd>{{ comp.tipoMemoria }}</dd></div>
              <div *ngIf="comp.fattoreForma"><dt>Formato</dt><dd>{{ comp.fattoreForma }}</dd></div>
              <div *ngIf="comp.wattaggio"><dt>Wattaggio</dt><dd>{{ comp.wattaggio }}W</dd></div>
            </dl>
            <div class="footer">
              <span class="price">{{ comp.prezzo | number:'1.2-2' }} €</span>
              <div class="actions">
                <button (click)="aggiungiAllaConfigurazione(comp)">Aggiungi alla build</button>
                <button class="ghost" (click)="aggiungiComponenteAlCarrello(comp)">Nel carrello</button>
              </div>
            </div>
          </article>
        </div>
        <p *ngIf="componenti?.content?.length === 0 && !loadingComponenti" class="empty">
          Nessun componente trovato per i filtri selezionati.
        </p>
      </div>

      <div class="paginazione" *ngIf="componenti && componenti.totalPages > 1">
        <button (click)="paginaPrecedente()" [disabled]="componenti.number === 0">← Precedente</button>
        <span>Pagina {{ componenti.number + 1 }} di {{ componenti.totalPages }}</span>
        <button (click)="paginaSuccessiva()" [disabled]="componenti.number >= componenti.totalPages - 1">Successiva →</button>
      </div>
    </section>

    <aside class="riepilogo">
      <div class="box">
        <h2>Riepilogo configurazione</h2>
        <p *ngIf="!configurazione">Crea una configurazione per iniziare a comporre il tuo PC.</p>
        <ul *ngIf="configurazione">
          <li *ngFor="let voce of configurazione.voci">
            <div>
              <span class="nome">{{ voce.nomeComponente }}</span>
              <small class="tipologia">{{ voce.tipologia.replace('_', ' ') }} ×{{ voce.quantita }}</small>
            </div>
            <span class="prezzo">{{ (voce.prezzoUnitario * voce.quantita) | number:'1.2-2' }} €</span>
          </li>
        </ul>
        <div class="totale" *ngIf="configurazione">
          <span>Totale stimato</span>
          <strong>{{ valoreTotaleConfigurazione() | number:'1.2-2' }} €</strong>
        </div>
        <button class="btn" *ngIf="configurazione" (click)="aggiungiTuttaConfigurazioneAlCarrello()">
          Aggiungi configurazione al carrello
        </button>
        <a routerLink="/configurazioni" class="link">Vai alle configurazioni salvate →</a>
      </div>
    </aside>
  </div>
</section>
